<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="theme" content="Chirpy v2.7.1"><meta name="generator" content="Jekyll v4.1.1" /><meta property="og:title" content="CS Games 2015 Parallelism Challenge - A Simple Solution" /><meta name="author" content="Félix-Antoine Ouellet" /><meta property="og:locale" content="en_US" /><meta name="description" content="My personal blog." /><meta property="og:description" content="My personal blog." /><link rel="canonical" href="https://faouellet.github.io//csgames-simple/" /><meta property="og:url" content="https://faouellet.github.io//csgames-simple/" /><meta property="og:site_name" content="/* Insert Code Here */" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2016-02-05T00:00:00-05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="CS Games 2015 Parallelism Challenge - A Simple Solution" /> <script type="application/ld+json"> {"description":"My personal blog.","url":"https://faouellet.github.io//csgames-simple/","headline":"CS Games 2015 Parallelism Challenge - A Simple Solution","dateModified":"2016-02-05T00:00:00-05:00","@type":"BlogPosting","datePublished":"2016-02-05T00:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://faouellet.github.io//csgames-simple/"},"author":{"@type":"Person","name":"Félix-Antoine Ouellet"},"@context":"https://schema.org"}</script><title>CS Games 2015 Parallelism Challenge - A Simple Solution | /* Insert Code Here */</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" href="/assets/css/post.css" as="style"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/assets/js/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-71911238-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-71911238-1'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">/* Insert Code Here */</a></div><div class="site-subtitle font-italic"></div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/tabs/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tabs/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/tabs/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/tabs/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/faouellet" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://www.linkedin.com/in/felixantoineouellet/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['faouellet','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>CS Games 2015 Parallelism Challenge - A Simple Solution</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>CS Games 2015 Parallelism Challenge - A Simple Solution</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Fri, Feb 5, 2016, 12:00 AM -0500" > Feb 5, 2016 <i class="unloaded">2016-02-05T00:00:00-05:00</i> </span> by <span class="author"> Félix-Antoine Ouellet </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1171 words">6 min</span></div></div><div class="post-content"><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/csgames-logo.png" alt="Desktop View" /></p><p>What’s up people!</p><p>Now that a month has passed, surely you have found a, at least simple, solution to the challenge? Now, as I promised last month, let’s go over a simple solution for this challenge…</p><p>…or not!</p><p>See, after pondering the thought for a while, I’ve decided against publishing a full solution to the challenge. I think people should be able to come up with their own without any shortcuts. So instead of giving away a solution, I’ll be giving off some tips on how you can make the most of this challenge without losing your mind.</p><h2 id="tip-0-rage-quit">Tip 0: Rage quit</h2><figure><p style="text-align:center;"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/ragequit.jpg" alt="Image: A legitimate strategy" /></p><figcaption><span><center><i>A legitimate strategy</i></center></span></figcaption></figure><p>Winning a war doesn’t necessarily means winning every single battle. For some teams, it’s better to focus on other challenges or just get some rest before the next day’s challenges (this challenge was given quite late in the evening, when many were possibly burned out).</p><p>Also, the basic client given to the competitors already send random answers back to the server. So, who knows, you might get lucky (but you probably won’t).</p><p>With that being said, let’s go over some real tips for the ones <del>crazy</del> brave enough to step up to the challenge.</p><h2 id="tip-1-get-some-data">Tip 1: Get some data</h2><p>Quick question: can you solve a problem without any data?</p><div style="color:Black; background-color:Black; display:inline-block"> Protip: You can't</div><p>So with this in mind, the first thing you should do is capture some problems of each type that the server can send. With this you’ll able to easily verify that your solutions are, in fact, correct.</p><h2 id="tip-2-solve-the-problem-sequentially-first">Tip 2: Solve the problem sequentially first</h2><p>Given that this was a parallelism challenge, some might be tempted to go all out with a parallel algorithm right from the start. If this is your case, please calm yourself. It is far easier to solve a problem sequentially. Remember, you not only have to produce answers to the problems sent fast, but these answers also have to be correct.</p><p>To illustrate this, let’s take the problem of finding a value in an array. If we choose to implement a parallel solution first, we might end up with something like this.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
</pre><td class="rouge-code"><pre><span class="k">template</span> <span class="o">&lt;</span><span class="kt">size_t</span> <span class="n">N</span><span class="p">&gt;</span>
<span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="kt">bool</span><span class="p">,</span> <span class="n">N</span><span class="o">&gt;</span>
  <span class="n">SolveArrayProblems</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">N</span><span class="o">&gt;&amp;</span> <span class="n">arrays</span><span class="p">,</span>
                   <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">N</span><span class="o">&gt;&amp;</span> <span class="n">values</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="kt">bool</span><span class="p">,</span> <span class="n">N</span><span class="o">&gt;</span> <span class="n">answers</span> <span class="o">=</span> <span class="p">{</span> <span class="p">};</span>
  <span class="k">const</span> <span class="kt">int</span> <span class="n">nbThreads</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="o">::</span><span class="n">hardware_concurrency</span><span class="p">();</span>
  <span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="o">&gt;</span> <span class="n">workers</span><span class="p">[</span><span class="n">nbThreads</span><span class="p">];</span>

  <span class="c1">// For each problem</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">iProb</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iProb</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="o">++</span><span class="n">iProb</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">auto</span> <span class="n">begin</span> <span class="o">=</span> <span class="n">arrays</span><span class="p">[</span><span class="n">iProb</span><span class="p">].</span><span class="n">begin</span><span class="p">();</span>
    <span class="kt">size_t</span> <span class="n">nbElemPerRange</span> <span class="o">=</span> <span class="n">arrays</span><span class="p">[</span><span class="n">iProb</span><span class="p">].</span><span class="n">size</span><span class="p">()</span> <span class="o">/</span> <span class="n">nbThreads</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">partialAnswers</span><span class="p">(</span><span class="n">nbThreads</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

    <span class="c1">// We'll start as many threads as possible</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iThread</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iThread</span> <span class="o">&lt;</span> <span class="n">nbThreads</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="o">++</span><span class="n">iThread</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="c1">// Each thread will have an equal part of</span>
      <span class="c1">// the array to scan through...</span>
      <span class="n">workers</span><span class="p">[</span><span class="n">iThread</span><span class="p">]</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="p">{</span> <span class="p">[</span><span class="o">&amp;</span><span class="p">,</span> <span class="n">iProb</span><span class="p">,</span> <span class="n">iThread</span><span class="p">]()</span>
      <span class="p">{</span>
        <span class="n">partialAnswers</span><span class="p">[</span><span class="n">iThread</span><span class="p">]</span> <span class="o">=</span>
            <span class="n">std</span><span class="o">::</span><span class="n">count</span><span class="p">(</span><span class="n">begin</span> <span class="o">+</span> <span class="p">(</span><span class="n">nbElemPerRange</span> <span class="o">*</span> <span class="n">iThread</span><span class="p">),</span>
                       <span class="n">begin</span> <span class="o">+</span> <span class="p">(</span><span class="n">nbElemPerRange</span> <span class="o">*</span> <span class="p">(</span><span class="n">iThread</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)),</span>
                       <span class="n">values</span><span class="p">[</span><span class="n">iProb</span><span class="p">]);</span>
      <span class="p">}</span> <span class="p">};</span>
    <span class="p">}</span>

    <span class="c1">// ...except for the last one that will take the remainder</span>
    <span class="n">workers</span><span class="p">[</span><span class="n">nbThreads</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="p">{</span> <span class="p">[</span><span class="o">&amp;</span><span class="p">,</span> <span class="n">iProb</span><span class="p">]()</span>
    <span class="p">{</span>
      <span class="n">partialAnswers</span><span class="p">[</span><span class="n">nbThreads</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span>
          <span class="n">std</span><span class="o">::</span><span class="n">count</span><span class="p">(</span><span class="n">begin</span> <span class="o">+</span> <span class="p">(</span><span class="n">nbElemPerRange</span> <span class="o">*</span> <span class="p">(</span><span class="n">nbThreads</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)),</span>
                     <span class="n">arrays</span><span class="p">[</span><span class="n">iProb</span><span class="p">].</span><span class="n">end</span><span class="p">(),</span>
                     <span class="n">values</span><span class="p">[</span><span class="n">iProb</span><span class="p">]);</span>
    <span class="p">}</span> <span class="p">};</span>

    <span class="c1">// Make sure all threads are done</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">&amp;</span> <span class="n">w</span> <span class="o">:</span> <span class="n">workers</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">w</span><span class="p">.</span><span class="n">join</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">// Answer true if the value was found at least once</span>
    <span class="n">answers</span><span class="p">[</span><span class="n">iProb</span><span class="p">]</span> <span class="o">=</span>
         <span class="n">std</span><span class="o">::</span><span class="n">accumulate</span><span class="p">(</span><span class="n">partialAnswers</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span>
                         <span class="n">partialAnswers</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">answers</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>In short, we want to start as many threads as possible. To do so, we split an array so as to give each thread an (approximatively) equal share of the work to be done. Then, we start the threads by giving each of them a piece of the array. Then, we join them. Then, we give an answer based on the what the threads found. Finally, we start it all over for every other array that was part of the problem.</p><p>Phew!</p><p>It’ll work, but this is seriously not a solution that you should consider during the competition for two big reasons. First, its size makes it error prone (especially in a high stress environment like the CS Games). So you’ll waste a lot of time getting it right. Second, creating and destroying threads, which this solution does a lot of, takes time, which you don’t really have in this context.</p><p>Instead, you should concentrate on first solving the problem in a sequential fashion. For example, a simple sequential solution can be written in way less lines of code using the <a href="http://en.cppreference.com/w/cpp/algorithm/find"><code class="language-plaintext highlighter-rouge">std::find</code></a> algorithm.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="k">template</span> <span class="o">&lt;</span><span class="kt">size_t</span> <span class="n">N</span><span class="p">&gt;</span>
<span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="kt">bool</span><span class="p">,</span> <span class="n">N</span><span class="o">&gt;</span>  
  <span class="n">SolveArrayProblemsSeq</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">N</span><span class="o">&gt;&amp;</span> <span class="n">arrays</span><span class="p">,</span>
                        <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">N</span><span class="o">&gt;&amp;</span> <span class="n">values</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="kt">bool</span><span class="p">,</span> <span class="n">N</span><span class="o">&gt;</span> <span class="n">answers</span> <span class="o">=</span> <span class="p">{</span> <span class="p">};</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">iProb</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iProb</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="o">++</span><span class="n">iProb</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">answers</span><span class="p">[</span><span class="n">iProb</span><span class="p">]</span> <span class="o">=</span>
        <span class="n">std</span><span class="o">::</span><span class="n">find</span><span class="p">(</span><span class="n">arrays</span><span class="p">[</span><span class="n">iProb</span><span class="p">].</span><span class="n">begin</span><span class="p">(),</span>
                  <span class="n">arrays</span><span class="p">[</span><span class="n">iProb</span><span class="p">].</span><span class="n">end</span><span class="p">(),</span>
                  <span class="n">values</span><span class="p">[</span><span class="n">iProb</span><span class="p">])</span> <span class="o">!=</span> <span class="n">arrays</span><span class="p">[</span><span class="n">iProb</span><span class="p">].</span><span class="n">end</span><span class="p">();</span>
  <span class="p">}</span>

    <span class="k">return</span> <span class="n">answers</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>And not only is it shorter to write, it is easier to see that it is correct. So there you have it, a correct solution that you can then speed up with multiple threads.</p><h2 id="tip-3-parallelize-at-the-coarsest-level-possible">Tip 3: Parallelize at the coarsest level possible</h2><p>For the few that got the idea to write a sequential solution first, it seemed that the tentation to write a solution akin to the first one shown in the tip above was too great to resist. If this is your case, calm your tits.</p><p>As I’ve already mentionned, there is a time penalty associated with creating and destroying threads. So when you have to parallelize a time-constrained application, be sure to keep this overhead in mind. Especially when some challenge’s authors might reduce the time available for computation when evaluating the competitors’ solutions (tough they would be real assholes to do it).</p><p>One way to minimize the number of threads used is to parallelize at the coarsest level possible like in the code below.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="k">template</span> <span class="o">&lt;</span><span class="kt">size_t</span> <span class="n">N</span><span class="p">&gt;</span>
<span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="kt">bool</span><span class="p">,</span> <span class="n">N</span><span class="o">&gt;</span>
  <span class="n">SolveArrayProblemsPar</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">N</span><span class="o">&gt;&amp;</span> <span class="n">arrays</span><span class="p">,</span>
                      <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">N</span><span class="o">&gt;&amp;</span> <span class="n">values</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="kt">bool</span><span class="p">,</span> <span class="n">N</span><span class="o">&gt;</span> <span class="n">answers</span> <span class="o">=</span> <span class="p">{</span> <span class="p">};</span>
  <span class="n">std</span><span class="o">::</span><span class="kr">thread</span> <span class="n">workers</span><span class="p">[</span><span class="n">N</span><span class="p">];</span> <span class="c1">// Start only as many threads</span>
                          <span class="c1">// as there is problems to solve</span>

  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iProb</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iProb</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="o">++</span><span class="n">iProb</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">workers</span><span class="p">[</span><span class="n">iProb</span><span class="p">]</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="p">{</span> <span class="p">[</span><span class="o">&amp;</span><span class="p">,</span> <span class="n">iProb</span><span class="p">]()</span>
    <span class="p">{</span>
      <span class="n">answers</span><span class="p">[</span><span class="n">iProb</span><span class="p">]</span> <span class="o">=</span>
          <span class="n">std</span><span class="o">::</span><span class="n">find</span><span class="p">(</span><span class="n">arrays</span><span class="p">[</span><span class="n">iProb</span><span class="p">].</span><span class="n">begin</span><span class="p">(),</span>
                    <span class="n">arrays</span><span class="p">[</span><span class="n">iProb</span><span class="p">].</span><span class="n">end</span><span class="p">(),</span>
                    <span class="n">values</span><span class="p">[</span><span class="n">iProb</span><span class="p">])</span> <span class="o">!=</span> <span class="n">arrays</span><span class="p">[</span><span class="n">iProb</span><span class="p">].</span><span class="n">end</span><span class="p">();</span>
    <span class="p">}</span> <span class="p">};</span>
  <span class="p">}</span>

  <span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">&amp;</span> <span class="n">w</span> <span class="o">:</span> <span class="n">workers</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">w</span><span class="p">.</span><span class="n">join</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">answers</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>As you can see, changing the granularity of the threads made us use 4 times less threads than in the previous parallel solution. It also gave us a easier to reason about solution which could probably be programmed in less than half the time it’d likely take to program the other parallel solution.</p><p><strong>tl;dr</strong>: Be smart when designing a multithreaded application.</p><p><strong>Coming up next month</strong>: An even more efficient way to crush the competition.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/cs-games-2015-parallelism-challenge/'>CS Games 2015 Parallelism Challenge</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/parallelism/" class="post-tag no-text-decoration" >Parallelism</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=CS Games 2015 Parallelism Challenge - A Simple Solution - /* Insert Code Here */&url=https://faouellet.github.io//csgames-simple/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=CS Games 2015 Parallelism Challenge - A Simple Solution - /* Insert Code Here */&u=https://faouellet.github.io//csgames-simple/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=CS Games 2015 Parallelism Challenge - A Simple Solution - /* Insert Code Here */&url=https://faouellet.github.io//csgames-simple/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/database/">Database</a> <a class="post-tag" href="/tags/source-control/">Source Control</a> <a class="post-tag" href="/tags/c/">C++</a> <a class="post-tag" href="/tags/build-system/">Build System</a> <a class="post-tag" href="/tags/parallelism/">Parallelism</a> <a class="post-tag" href="/tags/compiler-development/">Compiler Development</a> <a class="post-tag" href="/tags/software-development/">Software Development</a> <a class="post-tag" href="/tags/c-amp/">C++AMP</a> <a class="post-tag" href="/tags/concurrency/">Concurrency</a> <a class="post-tag" href="/tags/gpgpu/">GPGPU</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/race-detection/"><div class="card-body"> <span class="timeago small" > Oct 10, 2016 <i class="unloaded">2016-10-10T00:00:00-04:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Homemade data race detector</h3><div class="text-muted small"><p> Note 1: What I’m presenting here is evidently not a production grade tool. In fact, I’d say it barely even qualify as a proof of concept. If you really want to debug multithreaded programs, please ...</p></div></div></a></div><div class="card"> <a href="/ampr/"><div class="card-body"> <span class="timeago small" > Nov 19, 2016 <i class="unloaded">2016-11-19T00:00:00-05:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>AMPR</h3><div class="text-muted small"><p> All the code for this article can be found here. Have you ever asked yourself: how do regexes works? Or, even better, have you ever thought that you could totally implement a regex engine that...</p></div></div></a></div><div class="card"> <a href="/csgames-efficient/"><div class="card-body"> <span class="timeago small" > Mar 3, 2016 <i class="unloaded">2016-03-03T00:00:00-05:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>CS Games 2015 Parallelism Challenge - A More Efficient Solution</h3><div class="text-muted small"><p> ![Desktop View]({{ “/assets/img/csgames-logo.png” }}) What’s up people! Last time, we went over some potential solutions for a problem given during the parallelism challenge. As you may remember ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/csgames-intro/" class="btn btn-outline-primary"><p>CS Games 2015 Parallelism Challenge - Introduction</p></a> <a href="/csgames-efficient/" class="btn btn-outline-primary"><p>CS Games 2015 Parallelism Challenge - A More Efficient Solution</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="font-italic text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> var options = { scriptUrl: '//insertcodehere.disqus.com/embed.js', disqusConfig: function() { this.page.url = 'https://faouellet.github.io//csgames-simple/'; this.page.identifier = '/csgames-simple/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://github.com/faouellet">Félix-Antoine Ouellet</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/database/">Database</a> <a class="post-tag" href="/tags/source-control/">Source Control</a> <a class="post-tag" href="/tags/c/">C++</a> <a class="post-tag" href="/tags/build-system/">Build System</a> <a class="post-tag" href="/tags/parallelism/">Parallelism</a> <a class="post-tag" href="/tags/compiler-development/">Compiler Development</a> <a class="post-tag" href="/tags/software-development/">Software Development</a> <a class="post-tag" href="/tags/c-amp/">C++AMP</a> <a class="post-tag" href="/tags/concurrency/">Concurrency</a> <a class="post-tag" href="/tags/gpgpu/">GPGPU</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://faouellet.github.io/{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
