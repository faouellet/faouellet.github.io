<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="theme" content="Chirpy v2.7.1"><meta name="generator" content="Jekyll v4.1.1" /><meta property="og:title" content="AMPR" /><meta name="author" content="Félix-Antoine Ouellet" /><meta property="og:locale" content="en_US" /><meta name="description" content="Accelerated Massively Parallel Regex" /><meta property="og:description" content="Accelerated Massively Parallel Regex" /><link rel="canonical" href="https://faouellet.github.io//ampr/" /><meta property="og:url" content="https://faouellet.github.io//ampr/" /><meta property="og:site_name" content="/* Insert Code Here */" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2016-11-19T00:00:00-05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="AMPR" /> <script type="application/ld+json"> {"description":"Accelerated Massively Parallel Regex","url":"https://faouellet.github.io//ampr/","headline":"AMPR","dateModified":"2016-11-19T00:00:00-05:00","@type":"BlogPosting","datePublished":"2016-11-19T00:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://faouellet.github.io//ampr/"},"author":{"@type":"Person","name":"Félix-Antoine Ouellet"},"@context":"https://schema.org"}</script><title>AMPR | /* Insert Code Here */</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" href="/assets/css/post.css" as="style"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/assets/js/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-71911238-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-71911238-1'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">/* Insert Code Here */</a></div><div class="site-subtitle font-italic"></div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/tabs/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tabs/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/tabs/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/tabs/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/faouellet" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://www.linkedin.com/in/felixantoineouellet/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['faouellet','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>AMPR</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>AMPR</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sat, Nov 19, 2016, 12:00 AM -0500" > Nov 19, 2016 <i class="unloaded">2016-11-19T00:00:00-05:00</i> </span> by <span class="author"> Félix-Antoine Ouellet </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2921 words">16 min</span></div></div><div class="post-content"><hr /><p>All the code for this article can be found <a href="https://github.com/faouellet/Sandbox/blob/master/CPP/ampr.cpp">here</a>.</p><hr /><p>Have you ever asked yourself: how do regexes works? Or, even better, have you ever thought that you could totally implement a regex engine that would be faster than what powers <code class="language-plaintext highlighter-rouge">std::regex</code>? If not, than you’re probably took a wrong turn somewhere on the interwebs and you should probably move along.</p><p>For those of you performance freaks that kept on reading, let me share some experiments I did with bringing a regex engine on the GPU using C++AMP.</p><h2 id="the-aho-corasick-string-matching-algorithm">The Aho-Corasick string matching algorithm</h2><p>At the heart of our regex engine will be the Aho-Corasick (AC) string matching algorithm. Briefly, this algorithm builds a state machine resembling a <a href="https://en.wikipedia.org/wiki/Trie">trie</a> which is then used to match patterns on a given string. In other words, each state in the AC state machine corresponds to a character that can be matched given the pattern(s) fed to the algorithm. Between each pair of these states there can be an edge that either signifies that:</p><ul><li>The two states linked together represents a valid sequence of characters in a matched string.<li>There was a problem fully matching a sequence so we’re backing up to the state which is the biggest prefix of what we succeeded to match.</ul><p>As an example (shamelessly taken from <a href="https://en.wikipedia.org/wiki/Aho%E2%80%93Corasick_algorithm">Wikipedia</a>), say we have the following pattern : “a|ab|bab|bc|bca|c|caa”. This will be used to construct this state machine:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/Ahocorasick.svg.png" alt="Desktop View" /></p><p>If you prefer code to pictures, here’s how an AC-using regex would be set up:</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">StringSearcher</span>
<span class="p">{</span>
<span class="nl">private:</span>
  <span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="n">NB_ASCII_VALUES</span> <span class="o">=</span> <span class="mi">128</span><span class="p">;</span>

  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">NB_ASCII_VALUES</span><span class="o">&gt;&gt;</span> <span class="n">mTransitionMatrix</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">mOutputTable</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">mDictionary</span><span class="p">;</span>
</pre></table></code></div></div><p>In order, we have:</p><ul><li><code class="language-plaintext highlighter-rouge">mTransitionMatrix</code>: The state machine represented as an adjacency matrix where rows correspond to states an columns correspond to possible state transition given an ASCII character.<li><code class="language-plaintext highlighter-rouge">mOutputTable</code>: A simple table to identify if a state is a complete match.<li><code class="language-plaintext highlighter-rouge">mDictionary</code>: A list of all possible patterns that we’re currently trying to match.</ul><p>Once we have the representation down, we need some helper functions.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="nl">private:</span>
<span class="kt">void</span> <span class="nf">AddState</span><span class="p">()</span>
<span class="p">{</span>
  <span class="c1">// Creating a new state filled with null transitions</span>
  <span class="n">mTransitionMatrix</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">();</span>
  <span class="n">mTransitionMatrix</span><span class="p">.</span><span class="n">back</span><span class="p">().</span><span class="n">fill</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>

  <span class="c1">// Also, this state does not represent a complete match</span>
  <span class="n">mOutputTable</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>The first one will be there to help us add a blank state to our state machine.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="kt">void</span> <span class="nf">AddSearchPattern</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">pattern</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// Nothing to do here</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">pattern</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span>
  <span class="p">{</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Enhancing our state machine with the input pattern</span>
  <span class="kt">int</span> <span class="n">currentState</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">chr</span> <span class="o">:</span> <span class="n">pattern</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mTransitionMatrix</span><span class="p">[</span><span class="n">currentState</span><span class="p">][</span><span class="n">chr</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">mTransitionMatrix</span><span class="p">[</span><span class="n">currentState</span><span class="p">][</span><span class="n">chr</span><span class="p">]</span> <span class="o">=</span>  <span class="n">mTransitionMatrix</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>

      <span class="n">AddState</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="n">currentState</span> <span class="o">=</span> <span class="n">mTransitionMatrix</span><span class="p">[</span><span class="n">currentState</span><span class="p">][</span><span class="n">chr</span><span class="p">];</span>
  <span class="p">}</span>

  <span class="c1">// At the end of the pattern we have a match</span>
  <span class="n">mOutputTable</span><span class="p">[</span><span class="n">currentState</span><span class="p">]</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">mDictionary</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>

  <span class="c1">// Don't forget the pattern we can match</span>
  <span class="n">mDictionary</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">pattern</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>The second helper function will be responsible of adding new patterns to search for in our regex engine. This will be done by adding states when necessary and adding transitions between states based on input characters.</p><p>With these helper functions, we can now define our regex’s constructor.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="nl">public:</span>
<span class="k">explicit</span> <span class="nf">StringSearcher</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">patternStr</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// Adding the root state</span>
  <span class="n">AddState</span><span class="p">();</span>

  <span class="c1">// Since we implement alternative ("|"), we split the</span>
  <span class="c1">// pattern using "|" as a delimiter</span>
  <span class="n">std</span><span class="o">::</span><span class="n">stringstream</span> <span class="n">stream</span><span class="p">{</span> <span class="n">patternStr</span> <span class="p">};</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">temp</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">patternVec</span><span class="p">;</span>

  <span class="k">while</span> <span class="p">(</span><span class="n">getline</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="sc">'|'</span><span class="p">))</span>
  <span class="p">{</span>
    <span class="n">patternVec</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">temp</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Each alternative pattern is then added to the regex engine</span>
  <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">pattern</span> <span class="o">:</span> <span class="n">patternVec</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">AddSearchPattern</span><span class="p">(</span><span class="n">pattern</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>One thing you may notice is that I didn’t introduce back edges in the AC state machine like I’m supposed to. This was intentional since we won’t be needing it for what we’re about to do.</p><p>Optionally, readers are encouraged to implement the AC failure function as an exercise. Another cool thing to do is to implement other special character like “+” that I left out of the present implementation.</p><p>(I won’t lie, this is quite fun to finally be the one leaving holes in his article for “educational” purpose and definitely not because I’m lazy).</p><h2 id="adding-a-match">Adding a match</h2><p>Before continuing any further, I want to introduce the data type which will contain the result of a successful pattern match. There’s not really much to mention about it but it’s important to introduce it for the coming string matching algorithms.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="k">struct</span> <span class="nc">Match</span>
<span class="p">{</span>
  <span class="n">Match</span><span class="p">()</span> <span class="o">=</span> <span class="k">delete</span><span class="p">;</span>
  <span class="n">Match</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">start</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">length</span><span class="p">,</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">pattern</span><span class="p">)</span>
      <span class="o">:</span> <span class="n">Start</span><span class="p">{</span> <span class="n">start</span> <span class="p">},</span> <span class="n">Length</span><span class="p">{</span> <span class="n">length</span> <span class="p">},</span> <span class="n">Pattern</span><span class="p">{</span> <span class="n">pattern</span> <span class="p">}</span> <span class="p">{</span> <span class="p">}</span>

  <span class="kt">unsigned</span> <span class="n">Start</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="n">Length</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">Pattern</span><span class="p">;</span>
<span class="p">};</span>
</pre></table></code></div></div><p>Now back to the main event!</p><h2 id="celebrating-failure">Celebrating failure</h2><p>Right about now, you should be wondering: “How can we parallelize the computations done by the AC state machine?”. The answer is: let’s give up and fail!</p><figure><p style="text-align:center;"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/failure.jpg" alt="Image: When it's not simply failure." /></p><figcaption><span><center><i>When it's not simply failure.</i></center></span></figcaption></figure><p>In all seriousness tough, failing, not giving a damn about it and moving on is actually the very premise behind the Parallel Failureless Aho-Corasick (PFAC) algorihtm (I encourage you to check out <a href="http://www.ijircce.com/upload/2015/june/34_Optimization.pdf">[1]</a> and <a href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.103.4663&amp;rep=rep1&amp;type=pdf">[2]</a> where I first learned about this algorithm).</p><p>The way it works is as follows:</p><ol><li>Have each thread start at a given index in the string to match.<li>If there’s a match, record it.<li>Whether there’s a match or not, move on to the next index for the thread</ol><p>See, failure is not really failure when we can keep going forward (there seems to be a life lesson here but it’s totally lost on me).</p><p>An implementation of this idea would look like this:</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
</pre><td class="rouge-code"><pre><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Match</span><span class="o">&gt;</span> <span class="n">SearchMultithreadCPU</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">str</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// Some structures we'll need</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="o">&gt;</span> <span class="n">searchThreads</span><span class="p">;</span>
  <span class="k">const</span> <span class="k">auto</span> <span class="n">nbThreads</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="o">::</span><span class="n">hardware_concurrency</span><span class="p">();</span>
  <span class="k">const</span> <span class="k">auto</span> <span class="n">strSize</span> <span class="o">=</span> <span class="n">str</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Match</span><span class="o">&gt;</span> <span class="n">matches</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">mutex</span> <span class="n">matchMtx</span><span class="p">;</span>

  <span class="c1">// We'll start as many threads as there are hardware threads</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">iThread</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iThread</span> <span class="o">&lt;</span> <span class="n">nbThreads</span><span class="p">;</span> <span class="o">++</span><span class="n">iThread</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">searchThreads</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span>
        <span class="p">[</span><span class="k">this</span><span class="p">,</span> <span class="n">iThread</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nbThreads</span><span class="p">,</span>
         <span class="o">&amp;</span><span class="n">strSize</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">str</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">matches</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">matchMtx</span><span class="p">]()</span>
    <span class="p">{</span>
      <span class="c1">// Initially start at the thread index</span>
      <span class="kt">size_t</span> <span class="n">currentStrIdx</span> <span class="o">=</span> <span class="n">iThread</span><span class="p">;</span>

      <span class="k">while</span> <span class="p">(</span><span class="n">currentStrIdx</span> <span class="o">&lt;</span> <span class="n">strSize</span><span class="p">)</span>
      <span class="p">{</span>
        <span class="kt">int</span> <span class="n">currentState</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">iStr</span> <span class="o">=</span> <span class="n">currentStrIdx</span><span class="p">;</span> <span class="n">iStr</span> <span class="o">&lt;</span> <span class="n">strSize</span><span class="p">;</span> <span class="o">++</span><span class="n">iStr</span><span class="p">)</span>
        <span class="p">{</span>
          <span class="n">currentState</span> <span class="o">=</span> <span class="n">mTransitionMatrix</span><span class="p">[</span><span class="n">currentState</span><span class="p">][</span><span class="n">str</span><span class="p">[</span><span class="n">iStr</span><span class="p">]];</span>

          <span class="c1">// Nothing matched, shamefur dispray, commit sudoku</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">currentState</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
          <span class="p">{</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="p">}</span>

          <span class="c1">// Matched a character but not in a matching state,</span>
          <span class="c1">// let's continue</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">mOutputTable</span><span class="p">[</span><span class="n">currentState</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
          <span class="p">{</span>
            <span class="k">continue</span><span class="p">;</span>
          <span class="p">}</span>

          <span class="c1">// If we reach this point, it means we have a complete match</span>
          <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">iDict</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iDict</span> <span class="o">&lt;</span> <span class="n">mDictionary</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">iDict</span><span class="p">)</span>
          <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">mOutputTable</span><span class="p">[</span><span class="n">currentState</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">iDict</span><span class="p">))</span>
            <span class="p">{</span>
              <span class="n">std</span><span class="o">::</span><span class="n">lock_guard</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span> <span class="n">lock</span><span class="p">(</span><span class="n">matchMtx</span><span class="p">);</span>

              <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">matchedPattern</span> <span class="o">=</span> <span class="n">mDictionary</span><span class="p">[</span><span class="n">iDict</span><span class="p">];</span>
              <span class="k">const</span> <span class="kt">size_t</span> <span class="n">matchedLength</span> <span class="o">=</span> <span class="n">iStr</span> <span class="o">-</span> <span class="n">currentStrIdx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
              <span class="n">matches</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">currentStrIdx</span><span class="p">,</span>
                                   <span class="n">matchedLength</span><span class="p">,</span>
                                   <span class="n">matchedPattern</span><span class="p">);</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="c1">// Let's keep going</span>
        <span class="n">currentStrIdx</span> <span class="o">+=</span> <span class="n">nbThreads</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="c1">// Cleanup</span>
  <span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">&amp;</span> <span class="n">th</span> <span class="o">:</span> <span class="n">searchThreads</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">th</span><span class="p">.</span><span class="n">join</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">matches</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><h2 id="camp">C++AMP</h2><p>Alright, last stop before we implement our regex engine on the GPU.</p><p>C++ Accelerated Massive Parallelism (C++AMP) is an open standard, meaning anybody can access it and implement it, (<a href="https://github.com/RadeonOpenCompute/hcc">and some aready did</a>) by Microsoft that specifies language extensions and a small library to enable (mostly) painless computations on the GPU. To give you an overview of this technology, here’s an annotated version (by yours truly) of the <a href="https://blogs.msdn.microsoft.com/nativeconcurrency/2012/03/04/hello-world-in-c-amp/">“Hello world” example</a> on the C++AMP team’s blog.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre><td class="rouge-code"><pre><span class="cp">#include &lt;iostream&gt;
</span>
<span class="c1">// The C++AMP library is contained in amp.h</span>
<span class="cp">#include &lt;amp.h&gt;
</span>
<span class="c1">// Everything is contained in the concurrency namespace</span>
<span class="c1">// (like other Microsoft parallel technologies such as PPL)</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">concurrency</span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">v</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="sc">'G'</span><span class="p">,</span> <span class="sc">'d'</span><span class="p">,</span> <span class="sc">'k'</span><span class="p">,</span> <span class="sc">'k'</span><span class="p">,</span> <span class="sc">'n'</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="sc">'v'</span><span class="p">,</span> <span class="sc">'n'</span><span class="p">,</span> <span class="sc">'q'</span><span class="p">,</span> <span class="sc">'k'</span><span class="p">,</span> <span class="sc">'c'</span><span class="p">};</span>

  <span class="c1">// This is our view of (or reference to if you prefer)</span>
  <span class="c1">// the data on the GPU. It has a type, a dimension (1 by default)</span>
  <span class="c1">// and is initialized with a data structure on the CPU</span>
  <span class="n">array_view</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">av</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="n">v</span><span class="p">);</span>

  <span class="c1">// Basic parallel_for_each with a few twists:</span>
  <span class="c1">// - restrict(amp) tells it to execute its body on the GPU. This will</span>
  <span class="c1">//   implicitly transfer av's content to the GPU.</span>
  <span class="c1">// - its number of iteration is the length of av (av.extent)</span>
  <span class="c1">// - each iteration will receive an index (idx)</span>
  <span class="c1">//   going from 0 to av.extent-1</span>
  <span class="n">parallel_for_each</span><span class="p">(</span><span class="n">av</span><span class="p">.</span><span class="n">extent</span><span class="p">,</span> <span class="p">[</span><span class="o">=</span><span class="p">](</span><span class="n">index</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span> <span class="n">idx</span><span class="p">)</span> <span class="k">restrict</span><span class="p">(</span><span class="n">amp</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">av</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">});</span>

  <span class="c1">// Right here, after the execution of parallel_for_each, av will</span>
  <span class="c1">// be synchronized on the CPU i.e. the modifications done on the</span>
  <span class="c1">// GPU will be visible to CPU code allowing us to print "Hello world"</span>
  <span class="c1">// down below.</span>

  <span class="k">for</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">11</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">(</span><span class="n">av</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>There’s of course more to it that what I just showed but for our current needs it will be plenty enough.</p><p>Also, this technology seems to have been abandoned since 2014 (<a href="https://blogs.msdn.microsoft.com/nativeconcurrency/">last time the C++AMP team’s blog has been updated</a>), which is a damn shame if you ask me. Still, I had wanted to have a go at it for a long time and this project was the perfect excuse.</p><h2 id="how-to-fail-faster">How to fail faster</h2><p>Now that we finally have everything we need to implement PFAC on the GPU, let’s get to work!</p><p>First, we’ll create <code class="language-plaintext highlighter-rouge">array_view</code>s of the structures (state machine and all) need for the regex search. Most of the time, this will be straightforward.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Match</span><span class="o">&gt;</span> <span class="n">SearchAMP</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">str</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">using</span> <span class="k">namespace</span> <span class="n">concurrency</span><span class="p">;</span>

  <span class="k">const</span> <span class="kt">unsigned</span> <span class="n">strSize</span> <span class="o">=</span> <span class="n">str</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
  <span class="k">const</span> <span class="kt">unsigned</span> <span class="n">dictSize</span> <span class="o">=</span> <span class="n">mDictionary</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
  <span class="n">array_view</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">int</span><span class="p">,</span> <span class="mi">1</span><span class="o">&gt;</span> <span class="n">outputTableView</span><span class="p">(</span><span class="n">mOutputTable</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span>
                                           <span class="n">mOutputTable</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
  <span class="n">array_view</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">int</span><span class="p">,</span> <span class="mi">1</span><span class="o">&gt;</span> <span class="n">strView</span><span class="p">(</span><span class="n">strIntVec</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">strIntVec</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
</pre></table></code></div></div><p>But we’ll need to give our transition matrix a special treatment. The fact is that C++AMP only deals with contiguous data structures. That means that a <code class="language-plaintext highlighter-rouge">std::vector</code> of <code class="language-plaintext highlighter-rouge">std::array</code>, basically a pointer to an array of pointers, can’t be used as is to initialize an <code class="language-plaintext highlighter-rouge">array_view</code>. However, fixing this problem is quite easy as we only need to flatten our transition matrix before constructing our view.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="c1">// C++AMP needs dense data. Since the transition table isn't dense,</span>
<span class="c1">// we have to flatten it before moving it to the GPU</span>
<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">flatTransitionTable</span><span class="p">;</span>
<span class="n">flatTransitionTable</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span>
                    <span class="n">mTransitionMatrix</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">*</span> <span class="n">NB_ASCII_VALUES</span><span class="p">);</span>
<span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">row</span> <span class="o">:</span> <span class="n">mTransitionMatrix</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">flatTransitionTable</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">flatTransitionTable</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span>
                             <span class="n">row</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span>
                             <span class="n">row</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
<span class="p">}</span>
<span class="n">array_view</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">int</span><span class="p">,</span> <span class="mi">2</span><span class="o">&gt;</span> <span class="n">transitionTableView</span><span class="p">(</span>
                              <span class="n">mTransitionMatrix</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span>
                              <span class="n">NB_ASCII_VALUES</span><span class="p">,</span>
                              <span class="n">flatTransitionTable</span><span class="p">);</span>
</pre></table></code></div></div><p>Then there’s the problem of transferring the string on which will perform the search to the GPU. You see, C++AMP data structures can only be typed with something whose size is a multiple of the size of an int. And clearly, <code class="language-plaintext highlighter-rouge">char</code> doesn’t fit that requirement. So we have two options here: wasting space by using <code class="language-plaintext highlighter-rouge">int</code>s to hold our <code class="language-plaintext highlighter-rouge">char</code>s or packing our <code class="language-plaintext highlighter-rouge">char</code>s into <code class="language-plaintext highlighter-rouge">int</code>s. It goes without saying to we’ll go for the second option.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="c1">// To not waste any space, we'll pack the characters of the</span>
<span class="c1">// string argument into integers</span>
<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">strIntVec</span><span class="p">;</span>
<span class="n">strIntVec</span><span class="p">.</span><span class="n">reserve</span><span class="p">((</span><span class="n">strSize</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span><span class="p">);</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">iStr</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iStr</span> <span class="o">&lt;</span> <span class="n">strSize</span><span class="p">;</span> <span class="n">iStr</span> <span class="o">+=</span> <span class="mi">4</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">packedChars</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">packedChars</span> <span class="o">=</span> <span class="n">str</span><span class="p">[</span><span class="n">iStr</span><span class="p">];</span>
  <span class="n">packedChars</span> <span class="o">&lt;&lt;=</span> <span class="mi">8</span><span class="p">;</span>
  <span class="n">packedChars</span> <span class="o">|=</span> <span class="n">str</span><span class="p">[</span><span class="n">iStr</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
  <span class="n">packedChars</span> <span class="o">&lt;&lt;=</span> <span class="mi">8</span><span class="p">;</span>
  <span class="n">packedChars</span> <span class="o">|=</span> <span class="n">str</span><span class="p">[</span><span class="n">iStr</span><span class="o">+</span><span class="mi">2</span><span class="p">];</span>
  <span class="n">packedChars</span> <span class="o">&lt;&lt;=</span> <span class="mi">8</span><span class="p">;</span>
  <span class="n">packedChars</span> <span class="o">|=</span> <span class="n">str</span><span class="p">[</span><span class="n">iStr</span><span class="o">+</span><span class="mi">3</span><span class="p">];</span>
  <span class="n">strIntVec</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">packedChars</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Last but not least, we’ll define a structure to contain our pattern matches. This will be a matrix where the rows will represent a pattern to match and the column will represent a character in the input string. When a match will be made, we’ll write the length of the match in the cell corresponding to the pattern’s row and the beginning character’s column.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">results</span><span class="p">(</span><span class="n">strSize</span> <span class="o">*</span> <span class="n">dictSize</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
<span class="n">array_view</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">2</span><span class="o">&gt;</span> <span class="n">resultsView</span><span class="p">(</span><span class="n">strSize</span><span class="p">,</span> <span class="n">dictSize</span><span class="p">,</span> <span class="n">results</span><span class="p">);</span>
</pre></table></code></div></div><p>This may look like we’re doing do much redundant work here. Why not just build most of these views when constructing our regex engine? Well, the thing is that a lambda marked with <code class="language-plaintext highlighter-rouge">restrict(amp)</code> can’t capture <code class="language-plaintext highlighter-rouge">this</code> so member variables are a no go. This means that there’s pretty much no way that we could pre-initialize our structures on the GPU with C++AMP.</p><p>With that being said, let’s finally move on to the implementation of PFAC on the GPU.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
</pre><td class="rouge-code"><pre><span class="n">parallel_for_each</span><span class="p">(</span>
  <span class="n">extent</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">(</span><span class="n">strSize</span><span class="p">),</span> <span class="c1">// Iterating over the size of the input string</span>
  <span class="p">[</span><span class="n">transitionTableView</span><span class="p">,</span> <span class="n">outputTableView</span><span class="p">,</span> <span class="n">resultsView</span><span class="p">,</span> <span class="n">strView</span><span class="p">,</span> <span class="n">strSize</span><span class="p">]</span>
  <span class="p">(</span><span class="n">index</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span> <span class="n">idx</span><span class="p">)</span> <span class="k">restrict</span><span class="p">(</span><span class="n">amp</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="c1">// Each parallel invocation of this lambda will start its</span>
    <span class="c1">// pattern matching at a different character</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">strStartIdx</span> <span class="o">=</span> <span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">currentState</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">currentChar</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="n">iStr</span> <span class="o">=</span> <span class="n">strStartIdx</span><span class="p">;</span> <span class="n">iStr</span> <span class="o">&lt;</span> <span class="n">strSize</span><span class="p">;</span> <span class="o">++</span><span class="n">iStr</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="c1">// Accessing a character</span>
      <span class="n">index</span> <span class="o">=</span> <span class="n">iStr</span> <span class="o">/</span> <span class="mi">4</span><span class="p">;</span>
      <span class="n">currentChar</span> <span class="o">=</span> <span class="n">strView</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="mi">3</span><span class="o">-</span><span class="p">(</span><span class="n">iStr</span> <span class="o">%</span> <span class="mi">4</span><span class="p">)))</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>

      <span class="n">currentState</span> <span class="o">=</span> <span class="n">transitionTableView</span><span class="p">[</span><span class="n">currentState</span><span class="p">][</span><span class="n">currentChar</span><span class="p">];</span>

      <span class="c1">// Nothing matched, shamefur dispray, commit sudoku</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">currentState</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
      <span class="p">{</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="c1">// Matched a character but not in a matching state, let's continue</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">outputTableView</span><span class="p">[</span><span class="n">currentState</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
      <span class="p">{</span>
        <span class="k">continue</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="c1">// If we reach this point, that means we have a complete match</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">iDict</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iDict</span> <span class="o">&lt;</span> <span class="n">resultsView</span><span class="p">.</span><span class="n">extent</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span> <span class="o">++</span><span class="n">iDict</span><span class="p">)</span>
      <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">outputTableView</span><span class="p">[</span><span class="n">currentState</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">iDict</span><span class="p">))</span>
        <span class="p">{</span>
          <span class="n">resultsView</span><span class="p">[</span><span class="n">strStartIdx</span><span class="p">][</span><span class="n">iDict</span><span class="p">]</span> <span class="o">=</span> <span class="n">iStr</span> <span class="o">-</span> <span class="n">strStartIdx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">});</span>

<span class="c1">// Magic synchronization of the results here!</span>

<span class="c1">// Creating the matches</span>
<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Match</span><span class="o">&gt;</span> <span class="n">matches</span><span class="p">;</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">iStr</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iStr</span> <span class="o">&lt;</span> <span class="n">strSize</span><span class="p">;</span> <span class="o">++</span><span class="n">iStr</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">iDict</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">iDict</span> <span class="o">&lt;</span> <span class="n">dictSize</span><span class="p">;</span> <span class="o">++</span><span class="n">iDict</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">matchLength</span> <span class="o">=</span> <span class="n">results</span><span class="p">[(</span><span class="n">iStr</span> <span class="o">*</span> <span class="n">dictSize</span><span class="p">)</span> <span class="o">+</span> <span class="n">iDict</span><span class="p">];</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">matchLength</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">matchedPattern</span> <span class="o">=</span> <span class="n">mDictionary</span><span class="p">[</span><span class="n">iDict</span><span class="p">];</span>
      <span class="n">matches</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">iStr</span><span class="p">,</span> <span class="n">matchLength</span><span class="p">,</span> <span class="n">matchedPattern</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">return</span> <span class="n">matches</span><span class="p">;</span>
</pre></table></code></div></div><h2 id="results">Results</h2><p>For the experimental setup, I’ve decided to take a somewhat long text and create a pattern out of some of its characters. Can you guess which book I’ve used?</p><p>As our baseline, we’ll use <code class="language-plaintext highlighter-rouge">std::regex_search</code>. This will then be compared to both the multithreaded PFAC on the CPU and the C++AMP implementation of PFAC.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
</pre><td class="rouge-code"><pre><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">pattern</span> <span class="o">=</span> <span class="s">"Helen|Achilles|Ulysses|Hector</span><span class="err">
</span><span class="s">                               |Andromache|Patroclus|Ajax</span><span class="err">
</span><span class="s">                               |Priam|Agamemnon|Cassandra"</span><span class="p">;</span>
  <span class="n">StringSearcher</span> <span class="n">searcher</span><span class="p">{</span> <span class="n">pattern</span> <span class="p">};</span>

  <span class="c1">// Reading Homer</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">textStr</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">ifstream</span> <span class="n">stream</span><span class="p">(</span><span class="s">"text.txt"</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">stream</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">textStr</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">ostringstream</span><span class="o">&amp;&gt;</span><span class="p">(</span>
        <span class="n">std</span><span class="o">::</span><span class="n">ostringstream</span><span class="p">{}</span> <span class="o">&lt;&lt;</span> <span class="n">stream</span><span class="p">.</span><span class="n">rdbuf</span><span class="p">()).</span><span class="n">str</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="k">else</span>
  <span class="p">{</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">smatch</span> <span class="n">match</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">regex</span> <span class="n">re</span><span class="p">{</span> <span class="n">pattern</span> <span class="p">};</span>

    <span class="k">auto</span> <span class="n">start</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
    <span class="n">std</span><span class="o">::</span><span class="n">regex_search</span><span class="p">(</span><span class="n">textStr</span><span class="p">,</span> <span class="n">match</span><span class="p">,</span> <span class="n">re</span><span class="p">);</span>
    <span class="k">auto</span> <span class="n">end</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"std::regex: "</span>
              <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">duration_cast</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">milliseconds</span><span class="o">&gt;</span><span class="p">(</span>
                <span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">).</span><span class="n">count</span><span class="p">()</span>
              <span class="o">&lt;&lt;</span> <span class="s">" ms</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="p">{</span>
    <span class="k">auto</span> <span class="n">start</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
    <span class="n">searcher</span><span class="p">.</span><span class="n">SearchMultithreadCPU</span><span class="p">(</span><span class="n">textStr</span><span class="p">);</span>
    <span class="k">auto</span> <span class="n">end</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"CPU PFAC: "</span>
              <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">duration_cast</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">milliseconds</span><span class="o">&gt;</span><span class="p">(</span>
                <span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">).</span><span class="n">count</span><span class="p">()</span>
              <span class="o">&lt;&lt;</span> <span class="s">" ms</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="p">{</span>
    <span class="k">auto</span> <span class="n">start</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
    <span class="n">searcher</span><span class="p">.</span><span class="n">SearchAMP</span><span class="p">(</span><span class="n">textStr</span><span class="p">);</span>
    <span class="k">auto</span> <span class="n">end</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"GPU PFAC: "</span>
              <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">duration_cast</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">milliseconds</span><span class="o">&gt;</span><span class="p">(</span>
                <span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">).</span><span class="n">count</span><span class="p">()</span>
              <span class="o">&lt;&lt;</span> <span class="s">" ms</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Now how well did we do against <code class="language-plaintext highlighter-rouge">std::regex</code>?</p><p>*<em>drumrolls</em>*</p><figure><p style="text-align:center;"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/regex_res1.png" alt="Image: This did not go as planned." /></p><figcaption><span><center><i>This did not go as planned.</i></center></span></figcaption></figure><p>Unfortunately, not so great. Even when I add a timer to get the actual computation performed on the GPU (see below) what I record still doesn’t match <code class="language-plaintext highlighter-rouge">std::regex</code>’s performance.</p><figure><p style="text-align:center;"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/regex_res2.png" alt="Image: Still a long way to go" /></p><figcaption><span><center><i>Still a long way to go</i></center></span></figcaption></figure><h2 id="what-else-could-have-i-done">What else could have I done?</h2><p>Even tough the end result is a bit disappointing it is not entirely unexpected and there are two big reasons for that.</p><p>First, and I knew this when I started this little project, the algorithm that I’m using, the AC algorithm, is not the most efficient for implementing a regex engine. So the fact that I’m not starting from the most effective regex engine might’ve played against me.</p><p>On a side note, for those interested in regex implementation, <a href="https://swtch.com/~rsc/regexp/regexp1.html">here</a> <a href="https://en.wikipedia.org/wiki/Boyer%E2%80%93Moore_string_search_algorithm">are</a> <a href="https://lists.freebsd.org/pipermail/freebsd-current/2010-August/019310.html">good</a> <a href="https://www.youtube.com/watch?v=N_rkHzhXueo">starting</a> <a href="http://www.cs.princeton.edu/courses/archive/spr09/cos333/beautiful.html">points</a>.</p><p>The second explanation for the results we’ve seen that I can think of is that C++AMP wasn’t as easy to use as I thought and for all the syntatic sugar it offers, it doesn’t offer much when it comes to irregular computations on the GPU. It did make me think that eschewing syntactic sugar in favor of using lower level tools allowing us to have finer-grained control would be the way to go.</p><figure><p style="text-align:center;"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/webasm.png" alt="Image: But not always" /></p><figcaption><span><center><i>But not always</i></center></span></figcaption></figure><p>In the end, I still believe that the idea to parallelize regex matching based on the input string is a great idea and it kinda made me want to try to test it in a standard <code class="language-plaintext highlighter-rouge">std::regex</code> implementation.</p></div><div class="post-tail-wrapper text-muted"><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/c/" class="post-tag no-text-decoration" >C++</a> <a href="/tags/c-amp/" class="post-tag no-text-decoration" >C++AMP</a> <a href="/tags/parallelism/" class="post-tag no-text-decoration" >Parallelism</a> <a href="/tags/gpgpu/" class="post-tag no-text-decoration" >GPGPU</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=AMPR - /* Insert Code Here */&url=https://faouellet.github.io//ampr/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=AMPR - /* Insert Code Here */&u=https://faouellet.github.io//ampr/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=AMPR - /* Insert Code Here */&url=https://faouellet.github.io//ampr/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/database/">Database</a> <a class="post-tag" href="/tags/source-control/">Source Control</a> <a class="post-tag" href="/tags/c/">C++</a> <a class="post-tag" href="/tags/build-system/">Build System</a> <a class="post-tag" href="/tags/parallelism/">Parallelism</a> <a class="post-tag" href="/tags/compiler-development/">Compiler Development</a> <a class="post-tag" href="/tags/software-development/">Software Development</a> <a class="post-tag" href="/tags/c-amp/">C++AMP</a> <a class="post-tag" href="/tags/concurrency/">Concurrency</a> <a class="post-tag" href="/tags/gpgpu/">GPGPU</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/race-detection/"><div class="card-body"> <span class="timeago small" > Oct 10, 2016 <i class="unloaded">2016-10-10T00:00:00-04:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Homemade data race detector</h3><div class="text-muted small"><p> Note 1: What I’m presenting here is evidently not a production grade tool. In fact, I’d say it barely even qualify as a proof of concept. If you really want to debug multithreaded programs, please ...</p></div></div></a></div><div class="card"> <a href="/csgames-simple/"><div class="card-body"> <span class="timeago small" > Feb 5, 2016 <i class="unloaded">2016-02-05T00:00:00-05:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>CS Games 2015 Parallelism Challenge - A Simple Solution</h3><div class="text-muted small"><p> What’s up people! Now that a month has passed, surely you have found a, at least simple, solution to the challenge? Now, as I promised last month, let’s go over a simple solution for this challe...</p></div></div></a></div><div class="card"> <a href="/csgames-efficient/"><div class="card-body"> <span class="timeago small" > Mar 3, 2016 <i class="unloaded">2016-03-03T00:00:00-05:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>CS Games 2015 Parallelism Challenge - A More Efficient Solution</h3><div class="text-muted small"><p> What’s up people! Last time, we went over some potential solutions for a problem given during the parallelism challenge. As you may remember (if you don’t, go here), I put a special emphasis on ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/race-detection/" class="btn btn-outline-primary"><p>Homemade data race detector</p></a> <a href="/ddmutex/" class="btn btn-outline-primary"><p>A deadlock-detecting mutex</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="font-italic text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> var options = { scriptUrl: '//insertcodehere.disqus.com/embed.js', disqusConfig: function() { this.page.url = 'https://faouellet.github.io//ampr/'; this.page.identifier = '/ampr/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://github.com/faouellet">Félix-Antoine Ouellet</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/database/">Database</a> <a class="post-tag" href="/tags/source-control/">Source Control</a> <a class="post-tag" href="/tags/c/">C++</a> <a class="post-tag" href="/tags/build-system/">Build System</a> <a class="post-tag" href="/tags/parallelism/">Parallelism</a> <a class="post-tag" href="/tags/compiler-development/">Compiler Development</a> <a class="post-tag" href="/tags/software-development/">Software Development</a> <a class="post-tag" href="/tags/c-amp/">C++AMP</a> <a class="post-tag" href="/tags/concurrency/">Concurrency</a> <a class="post-tag" href="/tags/gpgpu/">GPGPU</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://faouellet.github.io/{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
