<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="theme" content="Chirpy v2.7.1"><meta name="generator" content="Jekyll v4.1.1" /><meta property="og:title" content="Building a build system - Part 1 - Dependency graph" /><meta name="author" content="Félix-Antoine Ouellet" /><meta property="og:locale" content="en_US" /><meta name="description" content="In which I show how to think about compilation." /><meta property="og:description" content="In which I show how to think about compilation." /><link rel="canonical" href="https://faouellet.github.io//bst-dg/" /><meta property="og:url" content="https://faouellet.github.io//bst-dg/" /><meta property="og:site_name" content="/* Insert Code Here */" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2018-02-28T00:00:00-05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Building a build system - Part 1 - Dependency graph" /> <script type="application/ld+json"> {"description":"In which I show how to think about compilation.","url":"https://faouellet.github.io//bst-dg/","headline":"Building a build system - Part 1 - Dependency graph","dateModified":"2018-02-28T00:00:00-05:00","@type":"BlogPosting","datePublished":"2018-02-28T00:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://faouellet.github.io//bst-dg/"},"author":{"@type":"Person","name":"Félix-Antoine Ouellet"},"@context":"https://schema.org"}</script><title>Building a build system - Part 1 - Dependency graph | /* Insert Code Here */</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" href="/assets/css/post.css" as="style"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/assets/js/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-71911238-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-71911238-1'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">/* Insert Code Here */</a></div><div class="site-subtitle font-italic"></div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/tabs/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tabs/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/tabs/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/tabs/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/faouellet" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://www.linkedin.com/in/felixantoineouellet/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['faouellet','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Building a build system - Part 1 - Dependency graph</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Building a build system - Part 1 - Dependency graph</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Wed, Feb 28, 2018, 12:00 AM -0500" > Feb 28, 2018 <i class="unloaded">2018-02-28T00:00:00-05:00</i> </span> by <span class="author"> Félix-Antoine Ouellet </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1140 words">6 min</span></div></div><div class="post-content"><p>How hard could it be to produce an executable out of some C++ files?</p><h2 id="compiling-a-c-application-the-wrong-way">Compiling a C++ application (the wrong way)</h2><p>A knee-jerk response to the question could be: “Not much! I just need to compile each of the files and then link the resulting object files together into an executble. There, done!”</p><p>Imagining for a moment that these source files are laid out in a folder hierarchy similar to the one shown in the <a href="https://faouellet.github.io/bst-intro/">introductory post</a> of this series, such an approach could be put into code in the following way:</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="k">namespace</span> <span class="n">fs</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">filsystem</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">CompileToExecutable</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">rootDir</span><span class="p">,</span>
                         <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">execName</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">objFiles</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">dirEntry</span>
                        <span class="o">:</span> <span class="n">fs</span><span class="o">::</span><span class="n">recursive_directory_iterator</span><span class="p">(</span><span class="n">rootDir</span><span class="p">))</span>
  <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">IsCPPFile</span><span class="p">(</span><span class="n">dirEntry</span><span class="p">))</span>
    <span class="p">{</span>
      <span class="k">continue</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">objFiles</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">CompileToObj</span><span class="p">(</span><span class="n">dirEntry</span><span class="p">));</span>
  <span class="p">}</span>
  
  <span class="n">LinkExecutable</span><span class="p">(</span><span class="n">objFiles</span><span class="p">,</span> <span class="n">execName</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>This might just work for the most basic of programs. But it might fail spectacularly for just about everything else.</p><figure><p style="text-align:center;"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/Homer-cereal-fire.jpg" alt="Image: Like so" /></p><figcaption><span><center><i>Like so</i></center></span></figcaption></figure><p>The problem at the heart of this algorithm is that it doesn’t take into consideration the possible dependencies between the different parts of the source code. As Ernest Hemingway once said: “No C++ file is an island”.</p><p>For instance, take the case of an onion-like codebase where multiples libraries are organized into several layers of abstractions. Generally, the upper layers will make use of the lower layers to build up their abstractions. It thus follows that, when compiling, you’d want the lower libraries to be compiled first so their symbols can be made available to the upper libraries. Failing to do so will undoubtedly result in a cornucopia of compiler and linker errors that will keep on piling up with no end in sight. Naturally, having that happen too often can send a normal programmer into a table-flipping fury and you wouldn’t want to live through that.</p><h2 id="dependency-graph">Dependency Graph</h2><p>The go-to solution to express dependencies in computer science is, as the above subtitle indicates, the dependency graph.</p><figure><p style="text-align:center;"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/depgraph.png" alt="Image: Your weapon of choice" /></p><figcaption><span><center><i>Your weapon of choice</i></center></span></figcaption></figure><p>In our current scenario, we’ll have the nodes represent either object files resulting from compilation, library files to be produced or the executable to be assembled (respectively blue, purple and red nodes). Between these nodes, we’ll insert edges to signify that an artifact depends on another artifact to be produced. For example, don’t create a library file before all the object files that should go into it have been produced.</p><h3 id="dependency-graph-construction">Dependency Graph Construction</h3><p>Building a dependency graph is surprisingly easy. let me walk you through it. First, we need to add the program’s entry point to the graph. As you’ll see later, this will constitute the graph’s root node. In our <a href="https://faouellet.github.io/bst-intro/">hypothetical source code structure</a>, this correspond to the <strong><code class="language-plaintext highlighter-rouge">main.cpp</code></strong> file right at the top.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="n">DependencyGraph</span> <span class="nf">BuildDepGraph</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">rootDir</span><span class="p">,</span>
                              <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">entryPoint</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">DependencyGraph</span> <span class="n">graph</span><span class="p">;</span>
  <span class="n">graph</span><span class="p">.</span><span class="n">AddNode</span><span class="p">(</span><span class="n">entryPoint</span><span class="p">);</span>
</pre></table></code></div></div><p>Next, we’ll add a node for each the folder adjacent to the entry point file. These will represent libraries to be built by our build system.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>  <span class="k">for</span><span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">rootDirEntry</span> <span class="o">:</span> <span class="n">fs</span><span class="o">::</span><span class="n">directory_iterator</span><span class="p">(</span><span class="n">rootDir</span><span class="p">))</span>
  <span class="p">{</span>
    <span class="c1">// Skipping over the main.cpp file</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">fs</span><span class="o">::</span><span class="n">is_directory</span><span class="p">(</span><span class="n">rootDirEntry</span><span class="p">))</span>
    <span class="p">{</span>
      <span class="k">continue</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">curDirname</span> <span class="o">=</span> <span class="n">rootDirEntry</span><span class="p">.</span><span class="n">path</span><span class="p">().</span><span class="n">string</span><span class="p">();</span>
    <span class="n">graph</span><span class="p">.</span><span class="n">AddNode</span><span class="p">(</span><span class="n">curDirname</span><span class="p">);</span>
</pre></table></code></div></div><p>Afterwards, we’ll look into each of the files in each of the folder to extract their dependencies and link them up in our graph.</p><p>Note that, for the sake of simplicity, we’ll assume that inter-library dependencies do not exist. Moreover, astute readers will notice that a graph built using the code below will be quite dense. This is intentional since I wanted to present the simplest algorithm possible. It’s definitly possible to make the graph sparser either by using another algorithm or running a post-processing step on the produced graph.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre>    <span class="k">for</span><span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">dirEntry</span> <span class="o">:</span> <span class="n">fs</span><span class="o">::</span><span class="n">directory_iterator</span><span class="p">(</span><span class="n">rootDirEntry</span><span class="p">))</span>
    <span class="p">{</span>
      <span class="c1">// Only files that actually get built are of interest to us</span>
      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">IsCPPFile</span><span class="p">(</span><span class="n">dirEntry</span><span class="p">))</span>
      <span class="p">{</span>
        <span class="k">continue</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">curFilename</span> <span class="o">=</span> <span class="n">dirEntry</span><span class="p">.</span><span class="n">path</span><span class="p">().</span><span class="n">string</span><span class="p">();</span>
      <span class="n">graph</span><span class="p">.</span><span class="n">AddNode</span><span class="p">(</span><span class="n">curFilename</span><span class="p">);</span>

      <span class="k">for</span><span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">dep</span> <span class="o">:</span> <span class="n">GetDependencies</span><span class="p">(</span><span class="n">curFilename</span><span class="p">))</span>
      <span class="p">{</span>
        <span class="n">graph</span><span class="p">.</span><span class="n">AddDependency</span><span class="p">(</span><span class="n">dep</span><span class="p">,</span> <span class="n">curFilename</span><span class="p">)</span>
      <span class="p">}</span>

      <span class="n">graph</span><span class="p">.</span><span class="n">AddDependency</span><span class="p">(</span><span class="n">curFilename</span><span class="p">,</span> <span class="n">curDirname</span><span class="p">);</span>
    <span class="p">}</span>
</pre></table></code></div></div><p>Finally, when we’re done with a folder, we’ll link up its associated node with the root node i.e. the program’s entry point.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>    <span class="n">graph</span><span class="p">.</span><span class="n">AddDependency</span><span class="p">(</span><span class="n">curDirname</span><span class="p">,</span> <span class="n">entryPoint</span><span class="p">);</span>
  <span class="err">}</span>

  <span class="k">return</span> <span class="n">graph</span><span class="p">;</span>
<span class="err">}</span>
</pre></table></code></div></div><h3 id="dependencies-extraction">Dependencies Extraction</h3><p>To extract the dependencies of a <strong><code class="language-plaintext highlighter-rouge">.cpp</code></strong> file, there’s nothing quite like a bit of regex-y magic. Take a <strong><code class="language-plaintext highlighter-rouge">.cpp</code></strong> file, open it up, apply spells written in an occult language that look like something out of the Necronomicon (or, worse, that look like a Perl program) and you get your dependencies.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre><span class="k">using</span> <span class="n">Dependencies</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">;</span>

<span class="n">Dependencies</span> <span class="nf">GetDependencies</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">sourceFile</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// Will match any include regardless of delimiter.</span>
  <span class="c1">// However, it'll only match .h and .hpp files.</span>
  <span class="c1">// The matched include (e.g. test\test.h) will be</span>
  <span class="c1">// in the 3rd capture group</span>
  <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">regex</span> <span class="n">includeRx</span><span class="p">{</span>
                <span class="s">"#include (</span><span class="se">\"</span><span class="s">|&lt;)([a-zA-Z0-9</span><span class="se">\\</span><span class="s">\/]+\.hp{0,2})(</span><span class="se">\"</span><span class="s">|&gt;)"</span> <span class="p">};</span>

  <span class="n">Dependencies</span> <span class="n">deps</span><span class="p">;</span>

  <span class="n">std</span><span class="o">::</span><span class="n">ifstream</span> <span class="n">fileStream</span><span class="p">{</span> <span class="n">sourceFile</span> <span class="p">};</span>
  <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">fileContent</span><span class="p">{</span>
                        <span class="n">std</span><span class="o">::</span><span class="n">istreambuf_iterator</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">{</span> <span class="n">fileStream</span> <span class="p">},</span>
                        <span class="n">std</span><span class="o">::</span><span class="n">istreambuf_iterator</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">{}</span> <span class="p">};</span>

  <span class="k">auto</span> <span class="n">rxIt</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">sregex_iterator</span><span class="p">(</span><span class="n">fileContent</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span>
                                   <span class="n">fileContent</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span>
                                   <span class="n">includeRx</span><span class="p">);</span>
  <span class="k">auto</span> <span class="n">rxEnd</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">sregex_iterator</span><span class="p">{};</span>
  <span class="k">for</span><span class="p">(;</span> <span class="n">rxIt</span> <span class="o">!=</span> <span class="n">rxEnd</span><span class="p">;</span> <span class="o">++</span><span class="n">rxIt</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">implFile</span> <span class="o">=</span> <span class="n">GetImplFile</span><span class="p">(</span><span class="n">rxIt</span><span class="o">-&gt;</span><span class="n">str</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">implFile</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span>
    <span class="p">{</span>
      <span class="n">deps</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">implFile</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">deps</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><h2 id="tooling">Tooling</h2><figure><p style="text-align:center;"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/someone-else.jpg" alt="Image: Can't the answer be 'Yes' for once?" /></p><figcaption><span><center><i>Can't the answer be 'Yes' for once?</i></center></span></figcaption></figure><p>When you’re a software developper, laziness is always an option. Therefore, I’d be remiss (or just plain lazy thus illustrating my point) if I didn’t mention that there are tools available to automatically extract source code dependencies. The one that I want to talk about, because it’s the most obvious, is the compiler. With the right switch, you can make it spit out. In the case of <strong><code class="language-plaintext highlighter-rouge">gcc</code></strong>, this switch is <strong><code class="language-plaintext highlighter-rouge">MMD</code></strong>.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>project
│ main.cpp
│
└─test1
│ │ test1.cpp
│ │ test1.h
│
│ test2.cpp
│ test2.h
</pre></table></code></div></div><p>Take the above project. To extract the dependencies within, one could invoke <strong><code class="language-plaintext highlighter-rouge">gcc</code></strong> as follows.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>g++ test1.cpp test2.cpp main.cpp <span class="nt">-o</span> main <span class="nt">-fsyntax-only</span> <span class="nt">-MMD</span>
</pre></table></code></div></div><p>The result of this compiler invocation will be a main.d file with the following contents.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>main: main.cpp test2.h test1/test1.h
</pre></table></code></div></div><p>If parsing a single file is more up your alley then you should seriously consider this option. You can’t go that wrong with it. The compiler is the Big Brother of your source code; he knows about source files and their close ones.</p><p>Lastly, before I start rambling on too much, this is but one option if you want to defer dependencies extraction to an external tool. If you’d prefer to go with something else, I’m sure you can find what you need <a href="http://lmgtfy.com/?q=extract+source+code+dependencies">if you make the effort</a>.</p><p><strong>Coming up next</strong>: Nice graph, but what can you do with it?</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/building-a-build-system/'>Building a build system</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/build-system/" class="post-tag no-text-decoration" >Build System</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Building a build system - Part 1 - Dependency graph - /* Insert Code Here */&url=https://faouellet.github.io//bst-dg/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Building a build system - Part 1 - Dependency graph - /* Insert Code Here */&u=https://faouellet.github.io//bst-dg/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Building a build system - Part 1 - Dependency graph - /* Insert Code Here */&url=https://faouellet.github.io//bst-dg/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/database/">Database</a> <a class="post-tag" href="/tags/source-control/">Source Control</a> <a class="post-tag" href="/tags/c/">C++</a> <a class="post-tag" href="/tags/build-system/">Build System</a> <a class="post-tag" href="/tags/parallelism/">Parallelism</a> <a class="post-tag" href="/tags/compiler-development/">Compiler Development</a> <a class="post-tag" href="/tags/software-development/">Software Development</a> <a class="post-tag" href="/tags/c-amp/">C++AMP</a> <a class="post-tag" href="/tags/concurrency/">Concurrency</a> <a class="post-tag" href="/tags/gpgpu/">GPGPU</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/bst-intro/"><div class="card-body"> <span class="timeago small" > Jan 31, 2018 <i class="unloaded">2018-01-31T00:00:00-05:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Building a build system - Part 0 - Intro</h3><div class="text-muted small"><p> In the fall of 2017, I had the opportunity to help a friend working at the University of Sherbrooke rebuild a course from the ground up. This course, IGL 601, had unfortunately devolved over the ye...</p></div></div></a></div><div class="card"> <a href="/bst-comp/"><div class="card-body"> <span class="timeago small" > Mar 31, 2018 <i class="unloaded">2018-03-31T00:00:00-04:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Building a build system - Part 2 - Compilation</h3><div class="text-muted small"><p> Have you ever sat in a data structures or algorithms class wondering why the teacher spend so much time on graph theory? Isn’t graph theory only useful for cracking the code interview? (I still can...</p></div></div></a></div><div class="card"> <a href="/bst-par/"><div class="card-body"> <span class="timeago small" > Apr 28, 2018 <i class="unloaded">2018-04-28T00:00:00-04:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Building a build system - Part 3 - Parallel Compilation</h3><div class="text-muted small"><p> At this point in the series, our build system does everything we wanted it to. Throw a simple source code repository at it and it’ll bring you back an application. Why don’t we call it quits now an...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/bst-intro/" class="btn btn-outline-primary"><p>Building a build system - Part 0 - Intro</p></a> <a href="/bst-comp/" class="btn btn-outline-primary"><p>Building a build system - Part 2 - Compilation</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="font-italic text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> var options = { scriptUrl: '//insertcodehere.disqus.com/embed.js', disqusConfig: function() { this.page.url = 'https://faouellet.github.io//bst-dg/'; this.page.identifier = '/bst-dg/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://github.com/faouellet">Félix-Antoine Ouellet</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/database/">Database</a> <a class="post-tag" href="/tags/source-control/">Source Control</a> <a class="post-tag" href="/tags/c/">C++</a> <a class="post-tag" href="/tags/build-system/">Build System</a> <a class="post-tag" href="/tags/parallelism/">Parallelism</a> <a class="post-tag" href="/tags/compiler-development/">Compiler Development</a> <a class="post-tag" href="/tags/software-development/">Software Development</a> <a class="post-tag" href="/tags/c-amp/">C++AMP</a> <a class="post-tag" href="/tags/concurrency/">Concurrency</a> <a class="post-tag" href="/tags/gpgpu/">GPGPU</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://faouellet.github.io/{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
